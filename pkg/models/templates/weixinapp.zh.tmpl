{{ define "__subject" -}}
ã€{{ .Signature }}ã€‘

{{- if eq (index .Alerts 0).Labels.severity "ok" }} OK{{ end }}
{{- if eq (index .Alerts 0).Labels.severity "info" }} INFO{{ end }}
{{- if eq (index .Alerts 0).Labels.severity "warning" }} WARNING{{ end }}
{{- if eq (index .Alerts 0).Labels.severity "critical" }} CRITICAL{{ end }}

{{- ` â€¢ ` }}

{{- if .CommonLabels.alertname_cn }}{{ .CommonLabels.alertname_cn }}{{ else if .CommonLabels.alertname_custom }}{{ .CommonLabels.alertname_custom }}{{ else if .CommonAnnotations.alertname  }}{{ .CommonAnnotations.alertname }}{{ else }}{{ .GroupLabels.alertname }}{{ end }}

{{- ` â€¢ ` }}

{{- if gt (.Alerts.Firing|len) 0 }}å‘Šè­¦ä¸­:{{ .Alerts.Firing|len }}{{ end }}
{{- if and (gt (.Alerts.Firing|len) 0) (gt (.Alerts.Resolved|len) 0) }}/{{ end }}
{{- if gt (.Alerts.Resolved|len) 0 }}å·²æ¢å¤:{{ .Alerts.Resolved|len }}{{ end }}

{{ end }}


{{ define "__externalURL" -}}
{{ .ExternalURL }}/#/alerts?receiver={{ .Receiver }}
{{- end }}

{{ define "__alertinstance" -}}
{{- if ne .Labels.alertinstance nil -}}{{ .Labels.alertinstance }}
{{- else if ne .Labels.instance nil -}}{{ .Labels.instance }}
{{- else if ne .Labels.node nil -}}{{ .Labels.node }}
{{- else if ne .Labels.nodename nil -}}{{ .Labels.nodename }}
{{- else if ne .Labels.host nil -}}{{ .Labels.host }}
{{- else if ne .Labels.hostname nil -}}{{ .Labels.hostname }}
{{- else if ne .Labels.ip nil -}}{{ .Labels.ip }}
{{- end -}}
{{- end }}

{{ define "__alert_list" }}
{{ range . }}
â£
<font color="comment"></font>
> <font color="comment"> å‘Šè­¦åç§° </font>: {{ if .Labels.alertname_cn  }}{{ .Labels.alertname_cn }}{{ else if .Labels.alertname_custom  }}{{ .Labels.alertname_custom }}{{ else if .Annotations.alertname  }}{{ .Annotations.alertname }}{{ else }}{{ .Labels.alertname }}{{ end }}
<font color="comment"> å‘Šè­¦çº§åˆ« </font>:{{ ` ` }}
{{- if eq .Labels.severity "ok" }}OK{{ end -}}
{{- if eq .Labels.severity "info" }}INFO{{ end -}}
{{- if eq .Labels.severity "warning" }}WARNING{{ end -}}
{{- if eq .Labels.severity "critical" }}CRITICAL{{ end }}
<font color="comment"> å‘Šè­¦å®ä¾‹ </font>: `{{ template "__alertinstance" . }}`
{{- if .Labels.region }}
<font color="comment"> åœ°åŸŸ </font>: {{ .Labels.region }}
{{- end }}
{{- if .Labels.zone }}
<font color="comment"> å¯ç”¨åŒº </font>: {{ .Labels.zone }}
{{- end }}
{{- if .Labels.product }}
<font color="comment"> äº§å“ </font>: {{ .Labels.product }}
{{- end }}
{{- if .Labels.component  }}
<font color="comment"> ç»„ä»¶ </font>: {{ .Labels.component }}
{{- end }}
<font color="comment"> å‘Šè­¦çŠ¶æ€ </font>: {{ if eq .Status "firing" }}ğŸš¨{{ else }}âœ…{{ end }} <font color="{{ if eq .Status "firing" }}warning{{ else }}info{{ end }}">{{ .Status | toUpper }}</font>
<font color="comment"> å¼€å§‹æ—¶é—´ </font>: {{ .StartsAt.Format "2006-01-02T15:04:05Z07:00" }}
<font color="comment"> ç»“æŸæ—¶é—´ </font>: {{ if .EndsAt.After .StartsAt }}{{ .EndsAt.Format "2006-01-02T15:04:05Z07:00" }}{{ else }}Not End{{ end }}
{{- if eq .Status "firing" }}
<font color="comment"> å‘Šè­¦æè¿° </font>: {{ if .Annotations.description_cn }}{{ .Annotations.description_cn }}{{ else }}{{ .Annotations.description }}{{ end }}
{{- end }}

{{ end }}
{{ end }}

{{ define "__alert_summary" -}}
{{ range . }}
<font color="{{ if eq .Status "firing" }}warning{{ else }}info{{ end }}">{{ template "__alertinstance" . }}</font>
{{- end }}
{{- end }}

{{ define "prom.title" -}}
{{ template "__subject" . }}
{{ end }}


{{ define "prom.markdown" }}
<font color="comment">{{ .MessageAt.Format "2006-01-02T15:04:05Z07:00" }}</font>
### å‘Šè­¦æ‘˜è¦

{{ if gt (.Alerts.Firing|len ) 0 }}
#### <font color="warning">ğŸš¨ è§¦å‘ä¸­å‘Šè­¦ [{{ .Alerts.Firing|len }}]</font>
{{ template "__alert_summary" .Alerts.Firing }}
{{ end }}


{{ if gt (.Alerts.Resolved|len) 0 }}
####  <font color="info">âœ… å·²æ¢å¤å‘Šè­¦ [{{ .Alerts.Resolved|len }}]</font>
{{ template "__alert_summary" .Alerts.Resolved }}
{{ end }}

### å‘Šè­¦è¯¦è¯·

{{ if gt (.Alerts.Firing|len ) 0 }}
#### <font color="warning">ğŸš¨ è§¦å‘ä¸­å‘Šè­¦ [{{ .Alerts.Firing|len }}]</font>
{{ template "__alert_list" .Alerts.Firing }}
{{ end }}


{{ if gt (.Alerts.Resolved|len) 0 }}
#####  <font color="info">âœ… å·²æ¢å¤å‘Šè­¦ [{{ .Alerts.Resolved|len }}]</font>
{{ template "__alert_list" .Alerts.Resolved }}
{{ end }}
{{ end }}

{{ define "prom.text" }}
{{ template "prom.markdown" . }}
{{ end }}
